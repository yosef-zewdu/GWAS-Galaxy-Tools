<tool id="window_ld" name="Windowed LD Calculator" version="1.0.0">
    <description>Compute LD (r²) for SNPs in a genomic window</description>

    <requirements>
        <requirement type="package" version="3.10">python</requirement>
        <requirement type="package" version="2.3.1">pandas</requirement>
        <requirement type="package" version="2.2.5">numpy</requirement>
        <requirement type="package" version="3.10.5">matplotlib</requirement>
    </requirements>

    <inputs>
        <param name="genotypes" type="data" format="tabular" label="Genotype matrix"/>
        <param name="snp_annotation" type="data" format="tabular" label="SNP annotation"/>
        <param name="focal_snp" type="text" value="" optional="true" label="Focal SNP ID"/>
        <param name="chrom" type="text" optional="true" label="Chromosome (if no focal SNP)"/>
        <param name="center_pos" type="integer" optional="true" label="Center position (bp)"/>
        <param name="window_kb" type="integer" value="250" label="Window size (kb)"/>
        <param name="min_maf" type="float" value="0.01" label="Minimum MAF"/>
        <param name="missing_code" type="text" value="NA" label="Missing value code"/>
    </inputs>

    <outputs>
        <data name="out_matrix" format="tabular" label="LD matrix TSV"/>
        <data name="out_png" format="png" label="LD heatmap PNG"/>
    </outputs>

    <command>
        python '/home/dyaz/icogLabs/tr01/GWAS_Tools/tools/window_ld/window_ld.py'
            --genotypes '${genotypes}'
            --snp_annotation '${snp_annotation}'
            #if str($focal_snp) != '':
            --focal_snp '${focal_snp}'
            #else
            --chrom '${chrom}' --center_pos ${center_pos}
            #end if
            --window_kb ${window_kb}
            --min_maf ${min_maf}
            --missing_code '${missing_code}'
            --out_matrix '${out_matrix}'
            --out_png '${out_png}'
    </command>

    <help>
        **Purpose:**  
        Calculates pairwise LD (r²) between SNPs within a window around a focal SNP.

        **Outputs:**  
        - TSV matrix of r² values.  
        - PNG heatmap of LD matrix.
    </help>
</tool>
